# SSTI

## Что такое SSTI

 **SSTI (инъекция в серверный шаблонизатор)** — это уязвимость, при которой злоумышленник внедряет код в шаблон, обрабатываемый на сервере. Если приложение не фильтрует ввод должным образом, шаблонизатор может **выполнить вредоносный код**, приведя к **полной компрометации сервера**. 
 
 ### Когда возникает SSTI: 
 
 - Приложение использует серверный шаблонизатор (Jinja2, Twig, Velocity, и т.п.) 
 - Пользовательский ввод вставляется в шаблон **напрямую** 
 - Отсутствует фильтрация/экранирование пользовательского ввода 
 
 **Пример:** 
 
 Пользователь вводит:

```txt
{{7*7}}
```

Если в ответе появляется 49, шаблонизатор выполнил код. Это уязвимость SSTI.

 ## Последствия

- **Выполнение произвольных команд на сервере (RCE)**
- **Доступ к конфиденциальным данным**
- **Управление файловой системой**
- **Захват учетных данных и внутренних сервисов**
- **Захват полного контроля над сервером**

---

## Пример уязвимого кода (Python + Jinja2)

```python
from flask import Flask, request, render_template_string

app = Flask(__name__)

@app.route('/')
def index():
    name = request.args.get('name', 'user')
    return render_template_string(f"Hello {name}!")
```

Если в name передать {{ 7*7 }}, вернётся Hello 49! — значит, ввод исполняется как код Jinja2.

## Методы защиты

| Метод                            | Суть                                                                       |
|-----------------------------------|----------------------------------------------------------------------------|
| **Изоляция логики и шаблона**     | Никогда не вставляйте данные напрямую в шаблон                             |
| **Автоэкранирование**             | Используйте шаблонизаторы с включённым автоматическим экранированием       |
| **Фильтрация ввода**              | Пропускайте только ожидаемые значения (whitelist)                          |
| **Ограниченная среда (sandbox)**  | Запрещайте доступ к системным объектам, модулю `os`, атрибутам `__class__` |
| **Использование безопасных фреймворков** | Например, Django по умолчанию экранирует переменные                  |


## Пример безопасного использования

```python
@app.route('/hello')
def hello():
    name = request.args.get('name', 'user')
    template = "Hello {{ name }}!"
    return render_template_string(template, name=name)
```

Теперь переменная name передаётся отдельно, а не через f-string.

## Почему SSTI опасна

- Она даёт злоумышленнику **доступ к контексту выполнения шаблона**
- Через шаблон можно обратиться к `__globals__`, `os`, `config` и т.д.
- Из шаблона реально получить доступ ко всему приложению, включая **системные команды**

---

## Резюме

- **SSTI** — это **серьёзная уязвимость** на стороне сервера
- Никогда не вставляйте данные **напрямую** в шаблоны
- Используйте **безопасные методы передачи данных** в шаблон
- **Экранирование**, **валидация** и **sandbox** — ключ к защите

---

## Полезные ссылки:

## Полезные ссылки:

- [OWASP: SSTI](https://owasp.org/www-community/attacks/Server_Side_Template_Injection)  
- [PortSwigger Web Security Academy: SSTI](https://portswigger.net/web-security/server-side-template-injection)  
- [PayloadsAllTheThings — SSTI Cheat Sheet](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection)  
- [HackTricks: SSTI](https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection)  
- [GeeksforGeeks: Server-Side Template Injection](https://www.geeksforgeeks.org/what-is-server-side-template-injection/)  


## Вся информация предоставлена исключительно в учебных целях.

> Используйте её **только для повышения безопасности**, а не для атак.

